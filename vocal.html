<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vocal Builder</title>

<style>
html, body {
  margin: 0;
  height: 100%;
  background: black;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  color: white;
}

body {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 40px 20px;
}

#inputField {
  width: 100%;
  max-width: 500px;
  height: 44px;
  background: transparent;
  border: 1px solid rgba(255,255,255,0.25);
  color: white;
  font-size: 18px;
  text-align: center;
  outline: none;
}

.buttonRow {
  margin-top: 18px;
  display: flex;
  gap: 20px;
}

button {
  width: 110px;
  height: 38px;
  background: transparent;
  border: 1px solid white;
  color: white;
  cursor: pointer;
}

/* Tighter control stack */
.sliderWrap {
  width: 100%;
  max-width: 500px;
  margin-top: 25px;
  display: flex;
  flex-direction: column;
  gap: 12px; /* reduced vertical spacing */
  font-size: 11px;
  letter-spacing: 2px;
}

.sliderWrap label {
  margin-bottom: -6px; /* pulls label closer */
  opacity: 0.75;
}

/* Thin black slider */
input[type=range] {
  appearance: none;
  width: 100%;
  height: 4px; /* thinner */
  border-radius: 3px;
  cursor: pointer;
  background: #000;
  border: 1px solid #111;
  transition: box-shadow 0.15s ease;
}

/* Hide thumb */
input[type=range]::-webkit-slider-thumb {
  appearance: none;
  width: 0;
  height: 0;
}

input[type=range]::-moz-range-thumb {
  width: 0;
  height: 0;
  border: none;
}
</style>
</head>

<body>

<input id="inputField" type="text" placeholder="Type vocal phrase..." />

<div class="buttonRow">
  <button id="listenBtn">LISTEN</button>
</div>

<div class="sliderWrap">

  <label>TONE</label>
  <input type="range" id="pitchSlider" min="0.5" max="2" step="0.01" value="1">

  <label>SPEED</label>
  <input type="range" id="speedSlider" min="0.5" max="1.5" step="0.01" value="1">

  <label>STRETCH</label>
  <input type="range" id="stretchSlider" min="0" max="1" step="0.01" value="0.5">

  <label>DE-HARSH</label>
  <input type="range" id="deharshSlider" min="0" max="1" step="0.01" value="0">

</div>

<script>

const sliders = document.querySelectorAll("input[type=range]");

/* Yellow fill logic */
function updateFill(slider) {
  const min = slider.min ? slider.min : 0;
  const max = slider.max ? slider.max : 100;
  const value = slider.value;

  const percent = ((value - min) / (max - min)) * 100;

  slider.style.background =
    `linear-gradient(to right, 
      rgba(255, 216, 77, 0.95) ${percent}%, 
      #000 ${percent}%)`;

  slider.style.boxShadow =
    `0 0 8px rgba(255, 216, 77, 0.25)`;
}

sliders.forEach(slider => {
  updateFill(slider);
  slider.addEventListener("input", () => updateFill(slider));
});

/* Speech engine */

const input = document.getElementById("inputField");
const listenBtn = document.getElementById("listenBtn");

const pitchSlider = document.getElementById("pitchSlider");
const speedSlider = document.getElementById("speedSlider");
const stretchSlider = document.getElementById("stretchSlider");
const deharshSlider = document.getElementById("deharshSlider");

function softenText(text, amount){
  if(amount === 0) return text;
  return text.replace(/p/gi,"b")
             .replace(/t/gi,"d")
             .replace(/k/gi,"g")
             .replace(/s/gi,"z");
}

function playFrozen(text) {
  speechSynthesis.cancel();

  let processed = softenText(text, parseFloat(deharshSlider.value));

  const words = processed.split(" ");
  let index = 0;

  function speakChunk(){
    if(index >= words.length) return;

    const utter = new SpeechSynthesisUtterance(words[index]);

    utter.pitch = parseFloat(pitchSlider.value);

    let rate = parseFloat(speedSlider.value) - (parseFloat(stretchSlider.value) * 0.8);
    if(rate < 0.1) rate = 0.1;

    utter.rate = rate;

    utter.onend = function(){
      index++;
      speakChunk();
    };

    speechSynthesis.speak(utter);
  }

  speakChunk();
}

listenBtn.addEventListener("click", () => {
  const text = input.value.trim();
  if (!text) return;
  playFrozen(text);
});
</script>

</body>
</html>
